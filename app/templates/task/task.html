{% extends "base.html" %}
{% block js %}
<script src="https://www.google.com/recaptcha/api.js" async defer></script>
{% endblock %}
{% block content %}
{% import 'helpers.html' as helpers %}
{{ helpers.form_errors(form) }}
<!-- Subheader -->
  <div class="sub-header">
    <div class="container">
      <h4 class="title">Task detail</h4>
      <div class="flex"></div>
      <ol class="breadcrumb">
        <li class="item"><a class="link" href="{{ url_for('index') }}">Home</a></li>
        <li class="item"><a class="link" href="{{ url_for('task.all_task') }}">Tasks</a></li>
        <li class="item active">Task detail</li>
      </ol>
    </div>
  </div><!--/ End Subheader -->

  <div class="main-container page-task-detail">
    <div class="container">
      <!-- <div class="alert alert-danger">{{ message }}</div> -->
      <h1 class="task-name">{{ task.name }} ({{ task.point }}pt)</h1>
      <p><span class="label label-danger label-task">{{ task.category.name }}</span></p>
      <div class="box-wrap">
        {{ task.description|safe }}
      </div>
      {% if g.user.is_admin() %}
      <br><a class="label label-info" href="{{ url_for('hint.create_hint') }}">New Hint</a><br>
      {% endif %}
      <p class="hint">
        {% for hint in task.hints %}
        {% if g.user.is_admin() or hint.is_open %}
        {% if g.user.is_admin() %}
        <a class="label label-primary" href="{{ url_for('hint.edit_hint', hint_id=hint.id) }}">Edit</a>
        {% if hint.is_open %}<span class="label label-success">Opened</span>{% else %}<span class="label label-danger">Closed</span>{% endif %}
        {% endif %}
        <strong>Hint:</strong> {{ hint.description|safe }}<br>
        {% endif %}
        {% endfor %}
      </p>

      <div class="solve-task">
        {% if g.user in task.solved_users %}
        <span class="text-success">You solved this task !</span><br>
        {% elif g.user.team and task in g.user.team.solved_tasks() %}
        <span class="text-success">Your team solved this task !</span><br>
        {% endif %}
        <span class="text-info">{{ task.solved_users|length }} users solved this task</span>
        <ul class="list-people">
          {% for user in task.solved_users %}
          <li class="item"><a href="{{ url_for('user.profile', user_id=user.id) }}"><img src="{{ user.get_avatar_url(23) }}" alt="{{ user.name }}" title="{{ user.name }}"></a></li>
          {% endfor %}
        </ul>
      </div>

      <form class="form-frag" role="form" action="" method="POST">
        <div class="form-group">
          <label>{{ form.flag.label }}</label>
          <input class="form-control" name="flag" type="text" size="50" required autofocus>
        </div>
        <div class="g-recaptcha" data-sitekey="{{ sitekey }}">
        </div>
        {{ form.hidden_tag() }}
        <button class="btn btn-primary" type="submit">Submit</button>
      </form>
    <div>
  </div>
</div>
{% endblock %}
